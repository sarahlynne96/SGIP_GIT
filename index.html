<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SGIP Residential Solar & Storage Equity Calculator</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin>
<script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin></script>
<style>
  :root{
    --primary:#fdb813;      /* orange bar                      */
    --secondary:#003c71;    /* CPUC navy                       */
    --accent:#005eb8;       /* link / focus accent             */
    --bg:#f5f5f5;
    --surface:#ffffff;
    --border:#e2e8f0;
    --text:#222;
    --muted:#555;
    --radius:8px;
    --shadow:0 2px 6px -2px rgba(0,0,0,.15);
    --fs-sm:.875rem;
    --fs-md:1rem;
    --fs-lg:1.25rem;
    --fs-xl:1.75rem;
  }
  *,*:before,*:after{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
  a{color:var(--accent);text-decoration:none}
  a:hover{text-decoration:underline}

  /* ---------- HEADER ---------- */
  header{
    background:var(--primary);
    padding:1.5rem 1rem;
    box-shadow:var(--shadow);
  }
  header h1{
    margin:0 auto;
    max-width:1080px;
    font-size:var(--fs-xl);
    font-weight:700;
    color:#000;
    line-height:1.2;
    text-align:center;
  }

  /* ---------- LAYOUT ---------- */
  .container{
    max-width:1080px;
    margin:auto;
    padding:1.5rem 1rem 3rem;
    display:flex;
    flex-direction:column;
    gap:2rem;
  }
  .card{
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:1.25rem 1.5rem;
  }
  h2.section{
    margin:.25rem 0 1rem;
    font-size:var(--fs-lg);
    color:var(--secondary);
  }
  h3{margin:1rem 0 .75rem;font-size:var(--fs-md);color:var(--secondary)}
  label{display:block;margin-bottom:.4rem;font-weight:600;color:var(--secondary)}
  input,select{
    width:100%;padding:.65rem .75rem;font-size:var(--fs-md);
    border:1px solid var(--border);border-radius:6px;background:#fff;color:inherit;
  }
  input:focus,select:focus{border-color:var(--accent);outline:2px solid var(--accent);}
  .help{font-size:var(--fs-sm);color:var(--muted);margin-top:.35rem}
  .error{color:#c0392b;font-size:var(--fs-sm);margin-top:.35rem}

  .actions{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:1rem}
  button{
    border:none;border-radius:6px;cursor:pointer;min-height:42px;
    padding:.6rem 1rem;font-size:var(--fs-md);transition:filter .15s;
  }
  .primary{background:var(--primary);color:#000}
  .primary:hover{filter:brightness(1.05)}
  .secondary{background:#fff;border:1px solid var(--border)}
  .secondary:hover{background:#f1f5f9}

  table.budget{
    width:100%;border-collapse:collapse;margin:1rem 0 .75rem
  }
  table.budget th,table.budget td{
    border:1px solid var(--border);padding:.5rem .6rem;font-size:var(--fs-sm);
    text-align:left
  }
  table.budget thead{background:var(--secondary);color:#fff}

  #result{white-space:pre-line;border-left:5px solid var(--primary);padding-left:1rem}

  /* ---------- MAPS ---------- */
  .maps iframe{width:100%;height:400px;border:0;border-radius:var(--radius)}
  #miniMap{height:240px;border:1px solid var(--border);border-radius:6px;margin-top:.6rem}

  /* ---------- TOTAL PILL ---------- */
  .total-pill{
    display:inline-block;background:var(--secondary);color:#fff;font-weight:700;
    padding:.25rem .75rem;border-radius:9999px;margin-top:.5rem;font-size:var(--fs-sm)
  }

  /* ---------- RESPONSIVE ---------- */
  @media(min-width:768px){
    h1{font-size:2rem}
  }
</style>
</head>
<body>
<header><h1>SGIP Residential Solar&nbsp;&amp;&nbsp;Storage Equity Calculator</h1></header>

<main class="container">
  <!-- QUESTIONS FORM (CENTER) -->
  <section class="card">
    <h2 class="section">Estimate your Incentive</h2>

    <table class="budget" aria-describedby="budget-note">
      <thead><tr><th>Budget</th><th>Total (2025)</th></tr></thead>
      <tbody>
        <tr><td>Residential Solar &amp; Storage Equity</td><td>$252 million</td></tr>
        <tr><td>Residential Storage Equity</td><td>$13 million</td></tr>
      </tbody>
    </table>
    <p id="budget-note" class="help">Figures mirror SGIP fact‑sheet (page 1). Possible waitlists when demand exceeds funds.</p>

    <!-- address checker & HUD blocks omitted for brevity; keep from last build if you need them -->

    <form id="calcForm" novalidate>
      <div class="form-field">
        <label for="customerType">Host Customer Class</label>
        <select id="customerType" required>
          <option value="">Select</option>
          <option value="residential-single">Residential Single‑Family</option>
          <option value="residential-multi">Residential Multifamily</option>
          <option value="commercial">Commercial/Business</option>
        </select>
        <div id="customerType-error" class="error hidden"></div>
      </div>

      <div class="form-field">
        <label for="capacity">Storage Capacity (kWh)</label>
        <input id="capacity" type="number" min="0" step="0.1" value="15">
        <div id="capacity-error" class="error hidden"></div>
      </div>

      <div class="form-field">
        <label for="solarCapacity">Solar PV Capacity (kW)</label>
        <input id="solarCapacity" type="number" min="0" step="0.1" value="5">
      </div>

      <div class="actions">
        <button class="primary" type="submit" id="runBtn">Calculate</button>
        <button class="secondary" type="reset" id="resetBtn">Clear</button>
      </div>
    </form>

    <output id="result" class="hidden" aria-live="polite"></output>
  </section>

  <!-- MAPS (BOTTOM) -->
  <section class="maps card">
    <h2 class="section">Reference Maps</h2>

    <h3>SB 535 Disadvantaged Communities Map</h3>
    <iframe src="https://experience.arcgis.com/experience/1c21c53da8de48f1b946f3402fbae55c/page/SB-535-Disadvantaged-Communities/" title="DAC Map"></iframe>

    <h3>Community Air Protection (CAP UC) Map</h3>
    <iframe src="https://capuc.maps.arcgis.com/apps/webappviewer/index.html?id=5bdb921d747a46929d9f00dbdb6d0fa2" title="CAP UC Map"></iframe>

    <h3>SCE Public‑Safety Shutoff Status</h3>
    <p><a href="https://www.sce.com/outages-safety/outage-center/check-outage-status" target="_blank" rel="noopener">Check PSPS status ↗</a></p>
  </section>
</main>

<script>
/* ===== very small JS just to demo new layout ===== */
const form = document.getElementById('calcForm');
const result = document.getElementById('result');
function money(n){return Number(n).toLocaleString()}
form.addEventListener('submit',e=>{
  e.preventDefault();
  const kWh = parseFloat(capacity.value)||0;
  const kW = parseFloat(solarCapacity.value)||0;
  if(kWh<=0){capacityError('Enter kWh');return}
  const storage = kWh*1000*1100;
  const solar = kW*3100;
  const total = storage+solar;
  result.innerHTML = `Estimated incentive\n• Storage $${money(storage)}\n• Solar $${money(solar)}\n\n<span class="total-pill">TOTAL $${money(total)}</span>`;
  result.classList.remove('hidden');
});
function capacityError(msg){
  document.getElementById('capacity-error').textContent=msg;
  document.getElementById('capacity-error').classList.remove('hidden');
}
document.getElementById('resetBtn').addEventListener('click',()=>result.classList.add('hidden'));
</script>
</body>
</html>
